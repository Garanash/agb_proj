<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—à–±–æ—Ä–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - Felix Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/favicon.svg">
</head>
<body class="bg-gray-100">
    <div id="app">
        <div class="min-h-screen bg-gray-100 flex items-center justify-center">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p class="text-gray-600">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞...</p>
            </div>
        </div>
    </div>

    <script>
        async function loadDashboard() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                const loginResponse = await fetch('http://localhost:8000/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });

                if (!loginResponse.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${loginResponse.status}`);
                }

                const loginData = await loginResponse.json();
                const token = loginData.access_token;

                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–∞—à–±–æ—Ä–¥–∞
                const statsResponse = await fetch('http://localhost:8000/api/v1/admin/dashboard/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!statsResponse.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${statsResponse.status}`);
                }

                const data = await statsResponse.json();
                renderDashboard(data);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                renderError(error.message);
            }
        }

        function renderDashboard(data) {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="min-h-screen bg-gray-100 p-6">
                    <div class="max-w-7xl mx-auto">
                        <h1 class="text-3xl font-bold text-gray-800 mb-8">
                            üöÄ –î–∞—à–±–æ—Ä–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π)
                        </h1>

                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-lg shadow-lg">
                                <div class="flex items-center">
                                    <div class="p-2 bg-blue-100 rounded-lg">
                                        <span class="text-2xl">üë•</span>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm text-gray-600">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                                        <p class="text-2xl font-bold text-gray-900">${data.total_users}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-lg shadow-lg">
                                <div class="flex items-center">
                                    <div class="p-2 bg-green-100 rounded-lg">
                                        <span class="text-2xl">‚úÖ</span>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm text-gray-600">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</p>
                                        <p class="text-2xl font-bold text-gray-900">${data.active_users}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-lg shadow-lg">
                                <div class="flex items-center">
                                    <div class="p-2 bg-purple-100 rounded-lg">
                                        <span class="text-2xl">üìÑ</span>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm text-gray-600">–°–æ–±—ã—Ç–∏—è</p>
                                        <p class="text-2xl font-bold text-gray-900">${data.total_events}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-lg shadow-lg">
                                <div class="flex items-center">
                                    <div class="p-2 bg-orange-100 rounded-lg">
                                        <span class="text-2xl">üì∞</span>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm text-gray-600">–ù–æ–≤–æ—Å—Ç–∏</p>
                                        <p class="text-2xl font-bold text-gray-900">${data.total_news}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º -->
                        <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                ${Object.entries(data.role_stats).map(([role, count]) => `
                                    <div class="text-center p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm text-gray-600 capitalize">${role}</p>
                                        <p class="text-2xl font-bold text-gray-900">${count}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-lg shadow-lg">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã</h3>
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                                            <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏</span>
                                            <span>${data.system_stats.memory_usage}%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: ${data.system_stats.memory_usage}%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                                            <span>–ó–∞–≥—Ä—É–∑–∫–∞ CPU</span>
                                            <span>${data.system_stats.cpu_usage}%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-green-600 h-2 rounded-full transition-all duration-300" style="width: ${data.system_stats.cpu_usage}%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                                            <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞</span>
                                            <span>${data.system_stats.disk_usage}%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-yellow-600 h-2 rounded-full transition-all duration-300" style="width: ${data.system_stats.disk_usage}%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-lg shadow-lg">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">API –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</span>
                                        <span class="font-semibold text-gray-900">${data.system_stats.api_requests_today.toLocaleString()}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–û—à–∏–±–∫–∏</span>
                                        <span class="font-semibold text-red-600">${data.system_stats.error_rate}%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</span>
                                        <span class="font-semibold text-green-600">${100 - data.system_stats.error_rate}%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</span>
                                        <span class="font-semibold text-gray-900">${data.system_stats.uptime}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
                        <div class="bg-white p-6 rounded-lg shadow-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                            <div class="space-y-3">
                                ${data.recent_users.map(user => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-2 h-2 rounded-full ${user.is_active ? 'bg-green-500' : 'bg-red-500'}"></div>
                                            <div>
                                                <p class="text-sm font-medium text-gray-900">
                                                    ${user.first_name && user.last_name 
                                                        ? `${user.first_name} ${user.last_name}` 
                                                        : user.username}
                                                </p>
                                                <p class="text-xs text-gray-600">@${user.username} ‚Ä¢ ${user.role}</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-xs text-gray-500">
                                                ${user.last_login ? new Date(user.last_login).toLocaleString() : '–ù–∏–∫–æ–≥–¥–∞'}
                                            </p>
                                            <p class="text-xs text-gray-500">
                                                ${new Date(user.created_at).toLocaleDateString()}
                                            </p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ -->
                        <div class="mt-6 text-center text-sm text-gray-500">
                            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date(data.last_updated).toLocaleString()}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderError(message) {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="min-h-screen bg-gray-100 flex items-center justify-center">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6 max-w-md">
                        <h2 class="text-red-800 font-bold text-lg mb-2">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                        <p class="text-red-600">${message}</p>
                    </div>
                </div>
            `;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞—à–±–æ—Ä–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadDashboard();
    </script>
</body>
</html>
