#!/bin/bash
# –°–ö–†–ò–ü–¢ –î–û–°–¢–ê–í–ö–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ù–ê –°–ï–†–í–ï–†

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
if [ $# -lt 1 ]; then
    echo "‚ùå –£–∫–∞–∂–∏—Ç–µ IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞"
    echo "–ü—Ä–∏–º–µ—Ä: ./deploy_fix_to_server.sh 123.456.789.0"
    exit 1
fi

SERVER_IP=$1
echo "üéØ –î–æ—Å—Ç–∞–≤–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä: $SERVER_IP"
echo "=========================================="

# 1. –ö–æ–ø–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
echo "üì¶ 1. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è..."
scp server_fix_all.sh root@$SERVER_IP:/tmp/

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
echo "üöÄ 2. –ó–∞–ø—É—Å–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."
ssh root@$SERVER_IP << EOF
    echo "üîß –ó–∞–ø—É—Å–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è..."
    chmod +x /tmp/server_fix_all.sh
    /tmp/server_fix_all.sh
EOF

echo ""
echo "üéâ –ì–û–¢–û–í–û!"
echo "=========="
echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ $SERVER_IP"
echo ""
echo "üåê –î–û–°–¢–£–ü –ö –ü–õ–ê–¢–§–û–†–ú–ï:"
echo "   URL: http://$SERVER_IP/login"
echo "   –õ–æ–≥–∏–Ω: admin"
echo "   –ü–∞—Ä–æ–ª—å: admin123"
