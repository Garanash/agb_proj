# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∏–Ω–æ–º –∞–¥–º–∏–Ω–∞

## üìã –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

–ï—Å–ª–∏ —É –≤–∞—Å –ø—Ä–æ–±–ª–µ–º–∞ —Å –≤—Ö–æ–¥–æ–º –∞–¥–º–∏–Ω–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

```bash
cd /root/agb_proj
./diagnose_login_issue.sh
```

## üéØ –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–ò–∑ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤–∏–¥–Ω–æ, —á—Ç–æ:
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç (nginx, backend, postgres)
- ‚úÖ API –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –æ–±–∞ –ø—É—Ç–∏
- ‚ùå –õ–æ–≥–∏–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 Unauthorized
- ‚ùå –ü—Ä–∏—á–∏–Ω–∞: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–µ—à –ø–∞—Ä–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üöÄ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd /root/agb_proj
chmod +x fix_login_issue.sh
./fix_login_issue.sh
```

### –°–ø–æ—Å–æ–± 2: –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker exec -it agb_backend bash

# 2. –û—Ç–ª–∞–¥—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—É —Å –ø–∞—Ä–æ–ª–µ–º
python debug_password.py

# 3. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø–∞—Ä–æ–ª—å
python quick_fix_password.py

# 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
python test_login_after_fix.py

# 5. –í—ã–π–¥–∏—Ç–µ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
exit
```

### –°–ø–æ—Å–æ–± 3: –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
docker exec -it agb_postgres psql -U felix_user -d agb_felix

# –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø–∞—Ä–æ–ª—å (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–µ—à)
UPDATE users SET hashed_password = '$2b$12$3hUFZdySaUzOeoGhfU7mseCvReNSdWuoEymkZHz8/ycZHzAHLtgQm' WHERE username = 'admin';

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT username, hashed_password FROM users WHERE username = 'admin';

# –í—ã–π–¥–∏—Ç–µ –∏–∑ PostgreSQL
\q
```

## üîë –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

- **–õ–æ–≥–∏–Ω:** `admin`
- **–ü–∞—Ä–æ–ª—å:** `admin123`
- **Email:** `admin@almazgeobur.ru`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://–í–ê–®_–°–ï–†–í–ï–†/login
2. –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω: `admin`
3. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å: `admin123`
4. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ API:
```bash
# –ß–µ—Ä–µ–∑ nginx
curl -X POST http://localhost/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# –ß–µ—Ä–µ–∑ backend –Ω–∞–ø—Ä—è–º—É—é
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "user": {
    "id": 2,
    "username": "admin",
    "email": "admin@almazgeobur.ru",
    "first_name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
    "last_name": "–°–∏—Å—Ç–µ–º—ã",
    "role": "admin",
    "is_active": true
  }
}
```

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ backend:**
   ```bash
   docker logs agb_backend
   ```

2. **–õ–æ–≥–∏ nginx:**
   ```bash
   docker logs agb_nginx
   ```

3. **–°–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   docker exec agb_postgres psql -U felix_user -d agb_felix -c "SELECT * FROM users WHERE username = 'admin';"
   ```

## üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS headers
curl -I http://localhost/api/auth/login
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Nginx –Ω–µ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
docker exec agb_nginx nginx -T | grep -A 10 "location /api"
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ backend
curl http://localhost:8000/api/health
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
1. –í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `./diagnose_login_issue.sh`
2. –õ–æ–≥–∏ backend: `docker logs agb_backend`
3. –õ–æ–≥–∏ nginx: `docker logs agb_nginx`

---

**‚úÖ –°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–±–ª–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
**üéØ –†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ö–µ—à –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
