#!/bin/bash
# –°–†–û–ß–ù–ê–Ø –î–û–°–¢–ê–í–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ù–ê –°–ï–†–í–ï–†

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
if [ $# -lt 1 ]; then
    echo "‚ùå –£–∫–∞–∂–∏—Ç–µ IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞"
    echo "–ü—Ä–∏–º–µ—Ä: ./urgent_fix.sh 123.456.789.0"
    exit 1
fi

SERVER_IP=$1
echo "üö® –°–†–û–ß–ù–ê–Ø –î–û–°–¢–ê–í–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ù–ê –°–ï–†–í–ï–†: $SERVER_IP"
echo "==================================================="

# 1. –ö–æ–ø–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
echo "üì¶ 1. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è..."
scp fix_database_now.sh root@$SERVER_IP:/tmp/

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
echo "üöÄ 2. –ó–∞–ø—É—Å–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."
ssh root@$SERVER_IP << EOF
    echo "üîß –ó–∞–ø—É—Å–∫ —Å—Ä–æ—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è..."
    chmod +x /tmp/fix_database_now.sh
    /tmp/fix_database_now.sh
EOF

echo ""
echo "üéâ –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!"
echo "================================="
echo "‚úÖ –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ $SERVER_IP"
echo ""
echo "üåê –î–û–°–¢–£–ü –ö –ü–õ–ê–¢–§–û–†–ú–ï:"
echo "   URL: http://$SERVER_IP/login"
echo "   –õ–æ–≥–∏–Ω: admin"
echo "   –ü–∞—Ä–æ–ª—å: admin123"
echo ""
echo "üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò:"
echo "   ‚úÖ column company_employees.first_name does not exist"
echo "   ‚úÖ column chat_rooms.is_active does not exist"
echo "   ‚úÖ column chat_folders.user_id does not exist"
echo "   ‚úÖ Frontend Connection closed - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ"
