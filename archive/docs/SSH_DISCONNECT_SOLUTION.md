# ðŸ”§ Ð ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ SSH Ð¿Ð¾ÑÐ»Ðµ ÑÐ±Ð¾Ñ€ÐºÐ¸

## ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°
ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° `deploy-server.sh` Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ SSH ÑÐµÑÑÐ¸Ð¸, Ñ‡Ñ‚Ð¾ Ð½Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ.

## ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ñ‹
1. **ÐÐµÑ…Ð²Ð°Ñ‚ÐºÐ° Ð¿Ð°Ð¼ÑÑ‚Ð¸** - Docker ÑÐ±Ð¾Ñ€ÐºÐ° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÑÐµÑ‚ Ð¼Ð½Ð¾Ð³Ð¾ RAM
2. **ÐÐµÑ…Ð²Ð°Ñ‚ÐºÐ° Ð¼ÐµÑÑ‚Ð° Ð½Ð° Ð´Ð¸ÑÐºÐµ** - ÐžÐ±Ñ€Ð°Ð·Ñ‹ Docker Ð·Ð°Ð½Ð¸Ð¼Ð°ÑŽÑ‚ Ð¼Ð½Ð¾Ð³Ð¾ Ð¼ÐµÑÑ‚Ð°
3. **ÐžÐ´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ ÑÐ±Ð¾Ñ€ÐºÐ° Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²** - Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ Ð¿Ð¸ÐºÐ¾Ð²ÑƒÑŽ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ
4. **ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ð¹ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²** - ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð¼Ð¾Ð³ÑƒÑ‚ "ÑÑŠÐµÑÑ‚ÑŒ" Ð²ÑÑŽ Ð¿Ð°Ð¼ÑÑ‚ÑŒ

## Ð ÐµÑˆÐµÐ½Ð¸Ñ

### 1. ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ - Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ðµ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ

```bash
# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ
./safe-deploy.sh
```

Ð­Ñ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚:
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹
- Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ swap Ñ„Ð°Ð¹Ð» ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾
- Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð¿Ð¾ÑÑ‚Ð°Ð¿Ð½Ð¾
- ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²

### 2. ðŸ” Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

```bash
# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÑƒ
./diagnose-server.sh
```

Ð­Ñ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚:
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ð¸ Ð´Ð¸ÑÐºÐ°
- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
- Ð›Ð¾Ð³Ð¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÑŽ

### 3. ðŸ› ï¸ Ð ÑƒÑ‡Ð½Ð¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

#### Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ swap Ñ„Ð°Ð¹Ð»Ð°:
```bash
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

#### ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Docker:
```bash
docker system prune -a -f
docker volume prune -f
```

#### ÐŸÐ¾ÑÑ‚Ð°Ð¿Ð½Ð°Ñ ÑÐ±Ð¾Ñ€ÐºÐ°:
```bash
# 1. Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker-compose -f docker-compose.optimized.yml up -d postgres
sleep 30

# 2. Redis
docker-compose -f docker-compose.optimized.yml up -d redis
sleep 15

# 3. Backend
docker-compose -f docker-compose.optimized.yml up -d backend
sleep 60

# 4. Frontend
docker-compose -f docker-compose.optimized.yml up -d frontend
sleep 30

# 5. Nginx
docker-compose -f docker-compose.optimized.yml up -d nginx
```

### 4. ðŸ”„ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ screen Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ screen ÐµÑÐ»Ð¸ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½
sudo apt-get install screen

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð² screen ÑÐµÑÑÐ¸Ð¸
screen -S deploy
./safe-deploy.sh

# ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÑÑŒ Ð¾Ñ‚ screen (Ctrl+A, Ð·Ð°Ñ‚ÐµÐ¼ D)
# Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ðº ÑÐµÑÑÐ¸Ð¸: screen -r deploy
```

### 5. ðŸ“Š ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²

```bash
# Ð¡Ð»ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð¿Ð°Ð¼ÑÑ‚Ð¸
htop

# Ð¡Ð»ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð° Docker
docker stats

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ Ð»Ð¾Ð³Ð¸
docker-compose -f docker-compose.optimized.yml logs -f
```

## ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `docker-compose.optimized.yml` Ð²Ð¼ÐµÑÑ‚Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ `docker-compose.yml`:

- ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
- ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ PostgreSQL
- ÐžÑ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½ÐµÐ½ÑƒÐ¶Ð½Ñ‹Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² (OCR, N8N) Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
- Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð½Ñ‹Ðµ health checks

## ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ

- **RAM**: 2GB (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ 4GB)
- **Ð”Ð¸ÑÐº**: 10GB ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¼ÐµÑÑ‚Ð°
- **CPU**: 2 ÑÐ´Ñ€Ð°
- **Swap**: 2GB

## ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾ÑÐ»Ðµ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
docker-compose -f docker-compose.optimized.yml ps

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ
curl http://localhost/api/health
curl http://localhost

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸
docker-compose -f docker-compose.optimized.yml logs | grep -i error
```

## Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÐµÑ‚ÑÑ

1. Ð£Ð²ÐµÐ»Ð¸Ñ‡ÑŒÑ‚Ðµ swap Ð´Ð¾ 4GB
2. ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð½ÐµÐ½ÑƒÐ¶Ð½Ñ‹Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
3. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð±Ð¾Ð»ÐµÐµ Ð¼Ð¾Ñ‰Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€
4. Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Docker BuildKit Ð´Ð»Ñ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ÑÐ±Ð¾Ñ€ÐºÐ¸

## Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

```bash
# ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹
docker-compose -f docker-compose.optimized.yml down

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÑÐµÑ€Ð²Ð¸ÑÑ‹
docker-compose -f docker-compose.optimized.yml restart

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²Ð¸ÑÐ°
docker-compose -f docker-compose.optimized.yml logs backend

# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²
docker-compose -f docker-compose.optimized.yml pull
```

## ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°

Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð½Ðµ Ñ€ÐµÑˆÐ°ÐµÑ‚ÑÑ, Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÑƒ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹:

```bash
./diagnose-server.sh > diagnosis.log 2>&1
```
