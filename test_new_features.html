<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ - –ó–∞–∫–∞–∑—á–∏–∫–∏ –∏ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: white;
            border-bottom: 1px solid white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>üõ†Ô∏è –¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–æ–≤ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</h1>

    <div class="tabs">
        <div class="tab active" onclick="showTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
        <div class="tab" onclick="showTab('login')">–í—Ö–æ–¥</div>
        <div class="tab" onclick="showTab('requests')">–ó–∞—è–≤–∫–∏</div>
        <div class="tab" onclick="showTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <div id="register" class="tab-content active">
        <div class="container">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ó–∞–∫–∞–∑—á–∏–∫–∞ (–ö–æ–º–ø–∞–Ω–∏–∏)</h2>
            <div class="form-group">
                <label for="customer_email">Email:</label>
                <input type="email" id="customer_email" value="customer_demo@test.com">
            </div>
            <div class="form-group">
                <label for="customer_password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="customer_password" value="demo123">
            </div>
            <div class="form-group">
                <label for="customer_first_name">–ò–º—è:</label>
                <input type="text" id="customer_first_name" value="–î–º–∏—Ç—Ä–∏–π">
            </div>
            <div class="form-group">
                <label for="customer_last_name">–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" id="customer_last_name" value="–ó–∞–∫–∞–∑—á–∏–∫">
            </div>
            <div class="form-group">
                <label for="customer_phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="customer_phone" value="+7(999)888-77-66">
            </div>
            <div class="form-group">
                <label for="company_name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏:</label>
                <input type="text" id="company_name" value="–û–û–û –†–µ–º–æ–Ω—Ç–ü—Ä–æ">
            </div>
            <div class="form-group">
                <label for="contact_person">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ:</label>
                <input type="text" id="contact_person" value="–î–º–∏—Ç—Ä–∏–π –ó–∞–∫–∞–∑—á–∏–∫">
            </div>
            <div class="form-group">
                <label for="company_phone">–¢–µ–ª–µ—Ñ–æ–Ω –∫–æ–º–ø–∞–Ω–∏–∏:</label>
                <input type="text" id="company_phone" value="+7(999)888-77-66">
            </div>
            <div class="form-group">
                <label for="company_email">Email –∫–æ–º–ø–∞–Ω–∏–∏:</label>
                <input type="email" id="company_email" value="info@remontpro.ru">
            </div>
            <div class="form-group">
                <label for="address">–ê–¥—Ä–µ—Å:</label>
                <input type="text" id="address" value="–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, 15">
            </div>
            <button onclick="registerCustomer()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ó–∞–∫–∞–∑—á–∏–∫–∞</button>
        </div>

        <div class="container">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</h2>
            <div class="form-group">
                <label for="contractor_email">Email:</label>
                <input type="email" id="contractor_email" value="contractor_demo@test.com">
            </div>
            <div class="form-group">
                <label for="contractor_password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="contractor_password" value="demo123">
            </div>
            <div class="form-group">
                <label for="contractor_first_name">–ò–º—è:</label>
                <input type="text" id="contractor_first_name" value="–ò–≤–∞–Ω">
            </div>
            <div class="form-group">
                <label for="contractor_last_name">–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" id="contractor_last_name" value="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å">
            </div>
            <div class="form-group">
                <label for="contractor_phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="contractor_phone" value="+7(999)777-66-55">
            </div>
            <div class="form-group">
                <label for="specialization">–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</label>
                <input type="text" id="specialization" value="–≠–ª–µ–∫—Ç—Ä–∏–∫">
            </div>
            <div class="form-group">
                <label for="experience_years">–°—Ç–∞–∂ (–ª–µ—Ç):</label>
                <input type="number" id="experience_years" value="5">
            </div>
            <div class="form-group">
                <label for="skills">–ù–∞–≤—ã–∫–∏:</label>
                <textarea id="skills">–†–µ–º–æ–Ω—Ç –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏, —ç–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</textarea>
            </div>
            <button onclick="registerContractor()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</button>
        </div>
    </div>

    <!-- –í—Ö–æ–¥ -->
    <div id="login" class="tab-content">
        <div class="container">
            <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            <div class="form-group">
                <label for="login_username">–õ–æ–≥–∏–Ω (username):</label>
                <input type="text" id="login_username" value="customer_demo">
            </div>
            <div class="form-group">
                <label for="login_password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="login_password" value="demo123">
            </div>
            <button onclick="login()">–í–æ–π—Ç–∏</button>
            <p><small>–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã: customer_demo/demo123, contractor_demo/demo123</small></p>
        </div>
    </div>

    <!-- –ó–∞—è–≤–∫–∏ -->
    <div id="requests" class="tab-content">
        <div class="container">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏</h2>
            <button onclick="getRequests()">–ü–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫–∏</button>
            <button onclick="createRequest()">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É (–ó–∞–∫–∞–∑—á–∏–∫)</button>
            <button onclick="respondToRequest()">–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –∑–∞—è–≤–∫—É (–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å)</button>
        </div>
    </div>

    <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
    <div id="profile" class="tab-content">
        <div class="container">
            <h2>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <button onclick="getProfile()">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
            <button onclick="getTelegramLink()">–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ Telegram –±–æ—Ç–∞</button>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div id="result" class="result info">
        –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
    </div>

    <script>
        let currentToken = null;
        let currentUser = null;

        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑—á–∏–∫–∞
        async function registerCustomer() {
            const data = {
                email: document.getElementById('customer_email').value,
                password: document.getElementById('customer_password').value,
                first_name: document.getElementById('customer_first_name').value,
                last_name: document.getElementById('customer_last_name').value,
                middle_name: '',
                phone: document.getElementById('customer_phone').value,
                company_name: document.getElementById('company_name').value,
                contact_person: document.getElementById('contact_person').value,
                company_phone: document.getElementById('company_phone').value,
                company_email: document.getElementById('company_email').value,
                address: document.getElementById('address').value
            };

            try {
                showResult('–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∑–∞–∫–∞–∑—á–∏–∫–∞...', 'info');
                const response = await fetch('/api/customers/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult(`‚úÖ –ó–∞–∫–∞–∑—á–∏–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!\nUsername: ${result.username}\nEmail: ${result.email}`, 'success');
                } else {
                    const error = await response.text();
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
        async function registerContractor() {
            const data = {
                email: document.getElementById('contractor_email').value,
                password: document.getElementById('contractor_password').value,
                first_name: document.getElementById('contractor_first_name').value,
                last_name: document.getElementById('contractor_last_name').value,
                middle_name: '',
                phone: document.getElementById('contractor_phone').value,
                specialization: document.getElementById('specialization').value,
                experience_years: parseInt(document.getElementById('experience_years').value),
                skills: document.getElementById('skills').value
            };

            try {
                showResult('–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è...', 'info');
                const response = await fetch('/api/contractors/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult(`‚úÖ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!\nUsername: ${result.username}\nEmail: ${result.email}`, 'success');
                } else {
                    const error = await response.text();
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
        async function login() {
            const data = {
                username: document.getElementById('login_username').value,
                password: document.getElementById('login_password').value
            };

            try {
                showResult('–í—ã–ø–æ–ª–Ω—è–µ–º –≤—Ö–æ–¥...', 'info');
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    currentToken = result.access_token;
                    currentUser = result.user;
                    showResult(`‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${result.user.first_name} ${result.user.last_name}\n–†–æ–ª—å: ${result.user.role}`, 'success');
                } else {
                    const error = await response.text();
                    showResult(`‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫–∏
        async function getRequests() {
            if (!currentToken) {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }

            try {
                showResult('–ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫...', 'info');
                const response = await fetch('/api/repair-requests/', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                if (response.ok) {
                    const requests = await response.json();
                    showResult(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –∑–∞—è–≤–æ–∫: ${requests.length}\n${JSON.stringify(requests, null, 2)}`, 'success');
                } else {
                    const error = await response.text();
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
        async function createRequest() {
            if (!currentToken || !currentUser || currentUser.role !== 'customer') {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∑–∞–∫–∞–∑—á–∏–∫', 'error');
                return;
            }

            const data = {
                title: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–º–æ–Ω—Ç',
                description: '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–º–æ–Ω—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –≤ –æ—Ñ–∏—Å–µ',
                urgency: '—Å—Ä–µ–¥–Ω–µ',
                address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–µ—Å—Ç–æ–≤–∞—è, 1',
                city: '–ú–æ—Å–∫–≤–∞',
                region: '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'
            };

            try {
                showResult('–°–æ–∑–¥–∞–µ–º –∑–∞—è–≤–∫—É...', 'info');
                const response = await fetch('/api/repair-requests/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult(`‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!\nID: ${result.id}\n–ù–∞–∑–≤–∞–Ω–∏–µ: ${result.title}`, 'success');
                } else {
                    const error = await response.text();
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –∑–∞—è–≤–∫—É
        async function respondToRequest() {
            if (!currentToken || !currentUser || currentUser.role !== 'contractor') {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', 'error');
                return;
            }

            // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –µ—Å—Ç—å –∑–∞—è–≤–∫–∞ —Å ID=1
            const data = {
                proposed_cost: 15000,
                estimated_days: 3,
                comment: '–ì–æ—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏ –≤ —Å—Ä–æ–∫'
            };

            try {
                showResult('–û—Ç–∫–ª–∏–∫–∞–µ–º—Å—è –Ω–∞ –∑–∞—è–≤–∫—É...', 'info');
                const response = await fetch('/api/repair-requests/1/respond', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult(`‚úÖ –û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!\nID –æ—Ç–∫–ª–∏–∫–∞: ${result.id}`, 'success');
                } else {
                    const error = await response.text();
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        async function getProfile() {
            if (!currentToken) {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }

            try {
                showResult('–ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å...', 'info');

                let endpoint;
                if (currentUser.role === 'customer') {
                    endpoint = '/api/customers/profile';
                } else if (currentUser.role === 'contractor') {
                    endpoint = '/api/contractors/profile';
                } else {
                    showResult('‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
                    return;
                }

                const response = await fetch(endpoint, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                if (response.ok) {
                    const profile = await response.json();
                    showResult(`‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—É—á–µ–Ω:\n${JSON.stringify(profile, null, 2)}`, 'success');
                } else {
                    const error = await response.text();
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ Telegram –±–æ—Ç–∞
        async function getTelegramLink() {
            if (!currentToken || !currentUser || currentUser.role !== 'contractor') {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', 'error');
                return;
            }

            try {
                showResult('–ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ Telegram –±–æ—Ç–∞...', 'info');
                const response = await fetch('/api/contractors/telegram-link', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult(`‚úÖ –°—Å—ã–ª–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞:\n${result.telegram_bot_link}\n\n${result.instructions}`, 'success');
                } else {
                    const error = await response.text();
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
