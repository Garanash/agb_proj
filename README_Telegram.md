# Telegram Bot Integration –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–∞—è–≤–æ–∫ –Ω–∞ —Ä–µ–º–æ–Ω—Ç

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å Telegram –±–æ—Ç–æ–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∑–∞—è–≤–∫–∞–º–∏ –Ω–∞ —Ä–µ–º–æ–Ω—Ç. –ë–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö
- –û—Ç–∫–ª–∏–∫–∞—Ç—å—Å—è –Ω–∞ –∑–∞—è–≤–∫–∏ —á–µ—Ä–µ–∑ inline –∫–Ω–æ–ø–∫–∏
- –£–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–∫–ª–∏–∫–∞–º–∏ –Ω–∞ –∑–∞—è–≤–∫–∏
- –ü–æ–ª—É—á–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –∑–∞—è–≤–æ–∫

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

1. **Telegram Bot Service** (`telegram_bot.py`) - —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º
2. **API —Ä–æ—É—Ç–µ—Ä—ã** (`routers/telegram.py`) - REST API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º
3. **–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö** (`models.py`) - TelegramBot, TelegramUser, TelegramNotification
4. **Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

```sql
-- –¢–∞–±–ª–∏—Ü—ã Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
telegram_bots          -- –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–æ–≤
telegram_users         -- —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å Telegram
telegram_notifications -- —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –≤ Telegram

1. –ù–∞–ø–∏—à–∏—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π `/newbot`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook
curl -X POST "http://localhost/api/telegram/bots/{bot_id}/webhook" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://your-domain.com/api/telegram/webhook/{bot_token}"}'
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ API

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
curl -X POST "http://localhost/api/telegram/bots" \
  -H "Authorization: Bearer {admin_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Repair Bot",
    "token": "YOUR_BOT_TOKEN",
    "is_active": true
  }'
```

## API Endpoints

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤
GET /api/telegram/bots

# –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞
POST /api/telegram/bots

# –û–±–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
PUT /api/telegram/bots/{bot_id}

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
POST /api/telegram/bots/{bot_id}/webhook
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

```bash
# –°–≤—è–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å Telegram
POST /api/telegram/users

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
GET /api/telegram/users
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ
POST /api/telegram/notify/new-request/{request_id}

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
GET /api/telegram/stats
```

## Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞

–ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç webhook –æ—Ç Telegram –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:

### –ö–æ–º–∞–Ω–¥—ã:
- `/start` - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
- `/help` - —Å–ø—Ä–∞–≤–∫–∞
- `/requests` - –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—è–≤–∫–∏
- `/my_responses` - –º–æ–∏ –æ—Ç–∫–ª–∏–∫–∏

### Callback –∑–∞–ø—Ä–æ—Å—ã:
- `respond_{request_id}` - –æ—Ç–∫–ª–∏–∫ –Ω–∞ –∑–∞—è–≤–∫—É

### –ü—Ä–∏–º–µ—Ä webhook URL:
```
https://your-domain.com/api/telegram/webhook/{bot_token}
```

## –†–∞–±–æ—Ç–∞ —Å –∑–∞—è–≤–∫–∞–º–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º –≤ Telegram
2. –°–æ–∑–¥–∞–µ—Ç inline –∫–Ω–æ–ø–∫—É "–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è"
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

```
üõ†Ô∏è –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–º–æ–Ω—Ç!

üìã –û–ø–∏—Å–∞–Ω–∏–µ: {description}
üìç –ê–¥—Ä–µ—Å: {address}
üè¢ –ì–æ—Ä–æ–¥: {city}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: {phone}
‚ö° –°—Ä–æ—á–Ω–æ—Å—Ç—å: {urgency}
üìÖ –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–∞—è –¥–∞—Ç–∞: {date}

–ó–∞–∫–∞–∑—á–∏–∫: {customer_name}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –î–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π

–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –º–æ–≥—É—Ç:

- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏
- –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –∑–∞—è–≤–∫—É –Ω–∞–∂–∞—Ç–∏–µ–º –∫–Ω–æ–ø–∫–∏
- –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–∞

### 2. –î–ª—è –∑–∞–∫–∞–∑—á–∏–∫–æ–≤

–ó–∞–∫–∞–∑—á–∏–∫–∏ –º–æ–≥—É—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –∑–∞—è–≤–æ–∫ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.

### 3. –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç:
- –£–ø—Ä–∞–≤–ª—è—Ç—å –±–æ—Ç–∞–º–∏
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–∞—Å—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```json
{
  "bots": {
    "total": 1,
    "active": 1
  },
  "users": {
    "total": 5,
    "contractors": 3
  },
  "notifications": {
    "total": 25,
    "unread": 2
  }
}
```

### –õ–æ–≥–∏

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –±–æ—Ç–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Telegram API –∏—Å–ø–æ–ª—å–∑—É—é—Ç HTTPS
- –¢–æ–∫–µ–Ω—ã –±–æ—Ç–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- Webhook URLs –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω—ã

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å webhook:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–≤—è–∑–∞–Ω—ã —Å Telegram
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å

### –ü—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–∫–ª–∏–∫–∞–º–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞—è–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∞–∫—Ç–∏–≤–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥:

1. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `telegram_bot.py`
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å–ø—Ä–∞–≤–∫—É –≤ –∫–æ–º–∞–Ω–¥–µ `/help`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ç–∏–ø –≤ enum `MessageType`
2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —Å–∏—Å—Ç–µ–º—ã.
