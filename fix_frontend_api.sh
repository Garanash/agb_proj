#!/bin/bash
# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API URL –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

echo "üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï API URL –î–õ–Ø –§–†–û–ù–¢–ï–ù–î–ê"
echo "==================================="

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üìã 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker-compose down

# –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
echo "üìã 2. –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º..."
docker-compose up --build -d

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
echo "üìã 3. –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤..."
sleep 10

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "üìã 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# –¢–µ—Å—Ç–∏—Ä—É–µ–º API
echo -e "\nüìã 5. –¢–µ—Å—Ç–∏—Ä—É–µ–º API..."
echo "–¢–µ—Å—Ç–∏—Ä—É–µ–º health:"
curl -s http://localhost/api/health

echo -e "\n–¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–Ω:"
curl -s -X POST http://localhost/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}' | jq .

echo -e "\n‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!"
echo -e "\nüîë –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏:"
echo "   URL: http://37.252.20.46/login"
echo "   –õ–æ–≥–∏–Ω: admin"
echo "   –ü–∞—Ä–æ–ª—å: admin123"
